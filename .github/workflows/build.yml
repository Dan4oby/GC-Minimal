name: Build pack

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: "21"

      - name: Download Pakku (pinned version)
        run: |
          PAKKU_VERSION="1.3.3"
          curl -L -o pakku.jar "https://github.com/juraj-hrivnak/Pakku/releases/download/v${PAKKU_VERSION}/pakku.jar"
          java -jar pakku.jar --version

      - name: Cache pakku.jar
        uses: actions/cache@v4
        with:
          path: pakku.jar
          key: pakku-1.3.3

      - name: Configure CurseForge credentials
        run: |
          java -jar pakku.jar credentials set --cf-api-key '${{ secrets.CF_API_KEY }}'

      - name: Fetch mods
        run: |
          java -jar pakku.jar fetch

      - name: Export multiplatform zip
        run: |
          java -jar pakku.jar export

      - name: Upload CurseForge build artifact
        uses: actions/upload-artifact@v4
        with:
          name: curseforge-pack
          path: build/curseforge/*.zip

      - name: Upload Modrinth build artifact
        uses: actions/upload-artifact@v4
        with:
          name: modrinth-pack
          path: build/modrinth/*.mrpack